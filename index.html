<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Scroll Audio with Section Backgrounds</title>
  <style>
    html, body { margin: 0; padding: 0; }
    #startStop {
      position: fixed; top: 10px; left: 10px; z-index: 100;
      padding: 8px 12px; font-size: 16px;
    }
    section {
      height: 100vh;
      display: flex; justify-content: center; align-items: center;
      font-size: 2rem;
    }
    /* Section-specific backgrounds */
    section[data-track="rainAudio"]   { background: #e0f7fa; }
    section[data-track="pianoAudio"]  { background: #ffe0b2; }
    section[data-track="kidsAudio"]   { background: #c8e6c9; }
  </style>
</head>
<body>
  <button id="startStop">Start Audio</button>

  <audio id="rainAudio" src="rain.mp3" preload="auto" loop></audio>
  <audio id="pianoAudio" src="piano.mp3" preload="auto" loop></audio>
  <audio id="kidsAudio"  src="kids_playing.mp3" preload="auto" loop></audio>

  <section data-track="rainAudio">Rain Sound</section>
  <section data-track="pianoAudio">Piano Sound</section>
  <section data-track="kidsAudio">Kids Playing</section>

  <script>
    let audioCtx = null;
    const tracks = {};

    document.getElementById('startStop').addEventListener('click', (e) => {
      const btn = e.target;
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        btn.textContent = 'Stop Audio';

        // Wire up each <audio> into the audio graph
        document.querySelectorAll('audio').forEach(el => {
          const srcNode = audioCtx.createMediaElementSource(el);
          srcNode.connect(audioCtx.destination);
          tracks[el.id] = { el, started: false };
        });

        // When 50% of a section is visible, start its track once
        const observer = new IntersectionObserver(entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const id = entry.target.dataset.track;
              const t  = tracks[id];
              if (!t.started) {
                t.el.play();
                t.started = true;
              }
            }
          });
        }, { threshold: 0.5 });

        document.querySelectorAll('section').forEach(sec => observer.observe(sec));
      } else {
        // Stop everything and reset
        Object.values(tracks).forEach(t => {
          t.el.pause();
          t.el.currentTime = 0;
          t.started = false;
        });
        audioCtx.close();
        audioCtx = null;
        btn.textContent = 'Start Audio';
      }
    });
  </script>
</body>
</html>
