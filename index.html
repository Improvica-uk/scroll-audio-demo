<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Scroll-Triggered Audio (Fully In-View)</title>
  <style>
    html, body { margin:0; padding:0; }
    #startStop {
      position: fixed; top:10px; left:10px; z-index:100;
      padding:8px 12px; font-size:16px;
    }
    section {
      height:100vh;
      display:flex; justify-content:center; align-items:center;
      font-size:2rem;
    }
    section[data-track="rain"]  { background:#e0f7fa; }
    section[data-track="piano"] { background:#ffe0b2; }
    section[data-track="kids"]  { background:#c8e6c9; }
  </style>
</head>
<body>
  <button id="startStop">Start Audio</button>

  <!-- Make sure these MP3s live next to your HTML on GH Pages -->
  <audio id="rain"  src="rain.mp3"          preload="auto" loop></audio>
  <audio id="piano" src="piano.mp3"         preload="auto" loop></audio>
  <audio id="kids"  src="kids_playing.mp3"  preload="auto" loop></audio>

  <section data-track="rain">Rain Sound</section>
  <section data-track="piano">Piano Sound</section>
  <section data-track="kids">Kids Playing</section>

  <script>
    const btn     = document.getElementById('startStop');
    const audios  = {};   // will hold { el: HTMLAudioElement, started: boolean }

    btn.addEventListener('click', () => {
      if (btn.dataset.running) {
        // ■ Stop
        Object.values(audios).forEach(a => {
          a.el.pause();
          a.el.currentTime = 0;
        });
        btn.textContent = 'Start Audio';
        btn.removeAttribute('data-running');
        return;
      }

      // ■ Start
      btn.textContent = 'Stop Audio';
      btn.dataset.running = 'true';

      // 1) Preplay & mute all audios
      document.querySelectorAll('audio').forEach(el => {
        el.volume = 0;
        el.play().catch(()=>{/* swallow autoplay rejections */});
        audios[el.id] = { el, started: false };
      });

      // 2) One IntersectionObserver for all sections
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          // Only when fully in view
          if (entry.intersectionRatio === 1) {
            const id = entry.target.dataset.track;
            const a  = audios[id];
            if (a && !a.started) {
              a.el.volume   = 0.5;   // bump volume instantly
              a.started     = true;
            }
          }
        });
      }, { threshold: 1.0 });

      // Observe every section
      document.querySelectorAll('section').forEach(sec => {
        observer.observe(sec);
      });
    });
  </script>
</body>
</html>
